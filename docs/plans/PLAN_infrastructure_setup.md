# 구현 계획서: 인프라 및 표준화 설정 (Infrastructure & Standardization)

**상태**: ✅ 완료 (Completed)
**시작일**: 2025-12-24
**완료 예정일**: 2025-12-24
**최종 수정일**: 2025-12-24

---

**⚠️ 중요 지침**: 각 단계(Phase) 완료 후 다음을 수행하십시오:
1. ✅ 완료된 태스크 체크박스 표시
2. 🧪 모든 품질 게이트(Quality Gate) 검증 명령어 실행
3. ⚠️ 모든 품질 게이트 항목이 통과하는지 확인
4. 📅 상단의 "최종 수정일" 업데이트
5. 📝 "노트 및 배운 점" 섹션에 기록
6. ➡️ 그 후 다음 단계로 진행

⛔ **품질 게이트를 건너뛰거나 실패한 상태로 진행하지 마십시오.**

---

## 📋 개요 (Overview)

### 기능 설명
`SKILL.md` 표준을 준수하기 위한 필수 개발 인프라를 구축합니다. 여기에는 코드 품질 도구(린트, 포맷팅), 테스트 커버리지 리포팅, 표준화된 예외 처리, 그리고 구조화된 로깅이 포함됩니다.

### 성공 기준
- [ ] `make test` 실행 시 테스트가 수행되고 커버리지 리포트가 생성되어야 함 (초기 설정 검증)
- [ ] `make lint` 실행 시 에러 없이 통과 (`flake8`)
- [ ] 코드가 자동으로 포맷팅되어야 함 (`black`)
- [ ] 표준화된 `CoreException` 클래스가 구현되어야 함
- [ ] 애플리케이션 로그가 콘솔 및 파일에 정해진 형식으로 출력되어야 함

### 사용자 영향
- 코드의 신뢰성과 유지보수성이 향상됩니다.
- 더 나은 로그를 통해 디버깅 시간이 단축됩니다.
- 팀/프로젝트 전반에 걸쳐 코드 일관성이 강화됩니다.

---

## 🏗️ 아키텍처 결정사항

| 결정 항목 | 근거 | 트레이드오프 |
|----------|-----------|------------|
| **도구 선정** | `flake8` (린트), `black` (포맷), `pytest-cov` (커버리지) | Python 표준 스택이며 통합이 용이함 |
| **Makefile** | `make`를 사용한 태스크 자동화 | 명령어 실행을 위한 단순하고 범용적인 인터페이스 제공 |
| **예외 계층** | `Exception`을 상속받는 `CoreException` 생성 | 애플리케이션 전용 에러를 전역적으로 처리 가능 |
| **로깅** | Python 내장 `logging` 및 핸들러 사용 | 기본 내장 기능으로 안정적이며 에러/정보 스트림 분리 용이 |

---

## 🛡️ 예외 처리 전략

| 시나리오 | 예상치 못한 동작 | 처리 전략 | 사용자 피드백 |
|----------|---------------------|-------------------|---------------|
| **비즈니스 로직 오류** | 잘못된 입력, 로직 위반 | `BusinessException` 발생 | Flash 메시지 표시 (경고) |
| **시스템 오류** | DB 실패, 네트워크 다운 | `SystemException` 발생 | 500 에러 페이지 표시 |
| **전역 폴백(Fallback)** | 처리되지 않은 예외 | Flask `errorhandler`가 500 포착 | "알 수 없는 오류가 발생했습니다" 페이지 |

---

## 📦 의존성 (Dependencies)

### 시작 전 요구사항
- [x] 기존 Flask 앱 구조

### 외부 라이브러리 추가
- `pytest-cov`
- `flake8`
- `black`

---

## 🧪 테스트 전략

### 테스트 접근 방식
**TDD 원칙**: 인프라 코드(예외 핸들러 등)도 단위 테스트를 통해 정상 작동 여부(트리거 및 포착)를 검증합니다.

### 테스트 피라미드
| 테스트 유형 | 커버리지 목표 | 목적 |
|-----------|-----------------|---------|
| **단위 테스트 (Unit)** | N/A (설정 중심) | 예외 클래스 정의 및 로깅 설정 검증 |
| **통합 테스트 (Integration)** | N/A | 에러 페이지가 올바르게 렌더링되는지 검증 |

---

## 🚀 구현 단계 (Implementation Phases)

### Phase 1: 도구 및 자동화 설정 (Tooling & Automation) 🛠️
**목표**: 도구를 설치하고 `Makefile`을 생성하여 명령 한 번으로 검증 가능하게 만듭니다.
**예상 소요 시간**: 2시간
**상태**: ⏳ 대기 중

#### Tasks

**🔴 RED: 실패하는 테스트 작성**
*인프라 단계는 주로 설정이지만, 도구의 존재 여부를 검증할 수 있습니다.*
- [x] **Test 1.1**: `pytest` 실행 가능 여부를 확인하는 더미 테스트 파일 `tests/unit/test_infra.py` 작성
  - 예상 결과: pytest 설정이 없거나 경로가 틀리면 실패

**🟢 GREEN: 테스트 통과를 위한 구현**
- [x] **Task 1.2**: 의존성 설치
  - `requirements.txt`에 추가: `pytest-cov`, `flake8`, `black`
  - `pip install -r requirements.txt` 실행

- [x] **Task 1.3**: 도구 설정
  - `.flake8` 생성 (max-line-length 120, flask 마이그레이션 파일 무시 등)
  - `pyproject.toml` 생성 (Black 설정 필요 시)

- [x] **Task 1.4**: `Makefile` 생성
  - 타겟: `test`, `lint`, `format`, `coverage`, `all`
  - 상세: `test`는 pytest 실행, `coverage`는 pytest-cov 실행

**🔵 REFACTOR: 코드 개선**
- [x] **Task 1.5**: 기존 코드에 `make format` 및 `make lint` 실행
  - `app/` 및 `tests/` 내의 기존 린트 에러 수정

#### Quality Gate ✋
**⚠️ 중요: 모든 항목이 통과하기 전까지 Phase 2로 넘어가지 마십시오**
- [x] **빌드**: `make all`이 에러 없이 실행됨
- [x] **린팅**: `flake8` 검사 결과 에러 0개
- [x] **포맷팅**: `black` 검사 결과 변경 사항 없음
- [x] **커버리지**: 커버리지 리포트가 생성됨 (수치는 낮아도 무방)

---

### Phase 2: 표준화 구현 (Exceptions & Logging) 🛡️
**목표**: 견고한 에러 처리 및 로깅 아키텍처를 구현합니다.
**예상 소요 시간**: 3시간
**상태**: ⏳ 대기 중

#### Tasks

**🔴 RED: 실패하는 테스트 작성**
- [x] **Test 2.1**: 단위 테스트 `tests/unit/test_exceptions.py` 작성
  - `CoreException`이 발생하고 메시지/코드를 전달하는지 테스트
  - `try...except CoreException` 블록이 정상 작동하는지 테스트

- [x] **Test 2.2**: 로깅 테스트 작성
  - 앱 로거가 존재하고 스트림/파일에 기록하는지 검증 (핸들러 Mocking)

**🟢 GREEN: 테스트 통과를 위한 구현**
- [x] **Task 2.3**: 예외 클래스 구현
  - 파일: `app/exceptions.py`
  - 클래스: `CoreException`, `BusinessException`, `SystemException`

- [x] **Task 2.4**: 로깅 설정
  - 파일: `app/__init__.py` (`create_app` 내부)
  - 설정: Console Handler (INFO 레벨), File Handler (ERROR 레벨)

**🔵 REFACTOR: 코드 개선**
- [x] **Task 2.5**: 전역 에러 핸들러 등록
  - 파일: `app/errors.py` (또는 메인 블루프린트)
  - 로직: `CoreException` 포착 시 Flash 메시지 표시 또는 에러 페이지 렌더링/리다이렉트

#### Quality Gate ✋
**⚠️ 중요: 모든 항목이 통과하기 전까지 진행하지 마십시오**
- [x] **TDD 준수**: 예외 처리에 대한 테스트가 통과함
- [x] **커버리지**: 예외 모듈 커버리지 100%
- [x] **린팅**: 에러 없음

---

### Phase 3: POC 및 최종 검증 🔍
**목표**: 기존 흐름(예: 로그인)에 표준을 적용하여 작동을 입증합니다.
**예상 소요 시간**: 1시간
**상태**: ⏳ 대기 중

#### Tasks

**🔴 RED: 실패하는 테스트 작성**
- [x] **Test 3.1**: 새로운 예외를 사용하는 로그인 실패 통합 테스트
  - 잘못된 정보로 로그인 시도 -> `BusinessException`이 발생하고 우아하게 처리되는지(Flash 메시지) 확인

**🟢 GREEN: 테스트 통과를 위한 구현**
- [x] **Task 3.2**: `app/auth/views.py` 리팩토링
  - 일반적인 에러 반환을 `BusinessException("비밀번호가 일치하지 않습니다")` 등으로 교체
  - 실패 시 로깅이 호출되는지 확인

**🔵 REFACTOR: 코드 개선**
- [x] **Task 3.3**: 로그 확인
  - 로그인 실패 시 로그 파일에 엔트리가 생성되었는지 확인

#### Quality Gate ✋
- [x] **수동 테스트**: 로그인 실패 시 UI에 올바른 피드백 표시
- [x] **로그**: 로그 파일에 모의 에러가 기록됨

---

## 📊 진행 상황 추적 (Progress Tracking)

### 완료 상태
- **Phase 1**: ✅ 100%
- **Phase 2**: ✅ 100%
- **Phase 3**: ✅ 100%

**전체 진행률**: 100% 완료

---

## 📝 노트 및 배운 점
- (구현 중 작성 예정)

---

## ✅ 최종 체크리스트
- [x] 모든 단계 완료
- [x] `make all`이 깨끗하게 통과함
- [x] 커버리지 리포트 생성 및 확인 가능
- [x] 로깅 작동 확인됨
